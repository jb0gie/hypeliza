<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Three.js Test (module)</title>
  <style>
    body { margin: 0; overflow: hidden; }
    canvas { display: block; }
  </style>

  <!-- 1️⃣  Import-map: tells the browser where each bare specifier lives -->
  <script type="importmap">
  {
    "imports": {
      "three": "https://cdn.jsdelivr.net/npm/three@0.132.2/build/three.module.js",
      "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.132.2/examples/jsm/",
      "@pixiv/three-vrm": "https://cdn.jsdelivr.net/npm/@pixiv/three-vrm@3.3.3/lib/three-vrm.module.js"
    }
  }
  </script>
</head>
<body>

<!-- 2️⃣  All JS is now a real ES-module -->
<script type="module">
  /* --- external deps ---------------------------------------------------- */
  import * as THREE from 'three';
  import { GLTFLoader }    from 'three/addons/loaders/GLTFLoader.js';
  import { RGBELoader }    from 'three/addons/loaders/RGBELoader.js';
  import { GLTFExporter }  from 'three/addons/exporters/GLTFExporter.js';
  import { VRMLoaderPlugin } from '@pixiv/three-vrm';
  import * as SkeletonUtils from 'three/addons/utils/SkeletonUtils.js';


  /* --- scene setup (unchanged) ----------------------------------------- */
  const scene    = new THREE.Scene();
  const camera   = new THREE.PerspectiveCamera(70, innerWidth / innerHeight, 0.1, 10000);
  const renderer = new THREE.WebGLRenderer({ alpha: true });
  renderer.setSize(innerWidth, innerHeight);
  document.body.appendChild(renderer.domElement);

  /* --- GLTF / VRM loader ------------------------------------------------ */
  const VRMLoader = new GLTFLoader();
  VRMLoader.register(parser => new VRMLoaderPlugin(parser));

  /* --- re-export to window to keep old code working -------------------- */
  window.scene          = scene;
  window.camera         = camera;
  window.renderer       = renderer;
  window.THREE          = THREE;                 // optional, mirrors old globals
  window.GLTFLoader     = GLTFLoader;
  window.VRMLoader      = VRMLoader;
  window.ObjectLoader   = THREE.ObjectLoader;
  window.MaterialLoader = THREE.MaterialLoader;
  window.TextureLoader  = new THREE.TextureLoader();
  window.GLTFExporter   = GLTFExporter;
  window.RGBELoader     = RGBELoader;
  window.SkeletonUtils = SkeletonUtils;
  
</script>
</body>
</html>
